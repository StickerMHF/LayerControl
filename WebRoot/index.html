<!DOCTYPE html>
<html>
  <head>
    <title>index.html</title>
	
    <meta name="keywords" content="keyword1,keyword2,keyword3">
    <meta name="description" content="this is my page">
    <meta name="content-type" content="text/html; charset=UTF-8">
    
    <link rel="stylesheet" type="text/css" href="css/leaflet.css">
    <link rel="stylesheet" type="text/css" href="css/zTreeStyle.css">
    	<script src="js/jquery-1.9.1.min.js"></script>
    	<script src="js/leafletplugin/leaflet.js"></script>
    	<script src="js/leafletplugin/esri-leaflet.js"></script>
    	<script src="js/jquery.ztree.core.js"></script>
    	<script src="js/jquery.ztree.excheck.js"></script>
    	<script src="js/layerData.js"></script>
    	<script src="js/ztree.js"></script>
<style>
html,body{padding:0;margin:0;width:100%;height:100%;}
	.whole{padding:0;margin:0;width:100%;height:100%;}
	.left{width:20%;height:100%;float: left;overflow-y: auto;}
	.right{width:80%;height:100%;float: left;}
</style>
  </head>
  
  <body>
    <div class="whole">
    	<div class="left">
    		<div id="treeDemo" class="ztree"></div>
    	</div>
    	<div id="map" class="right"></div>
    </div>
    <script>
    	var map = L.map('map').setView([34,106], 4);

  L.esri.basemapLayer('Streets').addTo(map);
  var dynamic=L.esri.dynamicMapLayer({
    url: 'http://192.168.0.2:6080/arcgis/rest/services/server/yqscdcdt/MapServer',
    opacity: 0.7
  }).addTo(map);
  var dynamicNodes,ztreeNodes;
  $.ajax({
				type : "POST",
				url : "http://localhost:8080/LayerControl/general/tree/rebulidJson",
				data : {
					"layerData" : JSON.stringify(LayerData),
					"mapService" : mapService
				},
				async : true,
				dataType : "json",
				success : function(msg) {
					ztreeNodes = msg.ztree;
					showZtree();
					dynamicNodes = msg.dynamic;
					dynamic.setLayerDefs(msg.dynamic[0].layerDefs);
					dynamic.setLayers(msg.dynamic[0].layers);
					$("#left1 .loading").css("display","none");
				}
		});
		
  
  //获取初始化显示图层
  var layers = new Array();
		for (var i = 0; i < LayerData.length; i++) {
			var layerIndex = LayerData[i].layerIndex;
			if(LayerData[i].checked){
				layers.push(layerIndex);
			}
		}
		dynamicNodes={"url":mapService,"layers":layers}
    </script>
  </body>
</html>
